<!DOCTYPE html>
<html lang="ar">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª</title>

    <style>
      body {
        font-family: Cairo, sans-serif;
        background: #f0f8ff;
        direction: rtl;
        padding: 10px;
      }

      .box {
        background: #fff;
        padding: 15px;
        border-radius: 14px;
        max-width: 1100px;
        margin: auto;
      }

      h2,
      h3 {
        text-align: center;
      }

      input {
        width: 100%;
        padding: 12px;
        margin-bottom: 12px;
        border-radius: 10px;
        border: 1px solid #aaa;
        font-size: 16px;
      }

      .table-wrap {
        overflow-x: auto;
        margin-bottom: 20px;
      }

      table {
        width: 100%;
        border-collapse: collapse;
        min-width: 650px;
      }

      th,
      td {
        border: 1px solid #ccc;
        padding: 8px;
        text-align: center;
        font-size: 14px;
      }

      th {
        background: #008cff;
        color: #fff;
      }

      button {
        border: none;
        padding: 8px 12px;
        border-radius: 8px;
        color: #fff;
        cursor: pointer;
        font-size: 14px;
        margin: 3px;
      }

      .del {
        background: #e53935;
      }

      .pay {
        background: #43a047;
      }

      #printPdf {
        background: #ff8c00;
      }

      #backBtn {
        background: #00bfff;
        font-weight: bold;
        font-size: 16px;
        padding: 12px;
        border-radius: 12px;
        width: 100%;
        margin-top: 10px;
      }

      .actions {
        display: flex;
        flex-direction: column;
        gap: 8px;
        margin-top: 15px;
      }
/* ===== ØªØµÙ…ÙŠÙ… Ø§Ù„ÙÙˆØªØ± ===== */
footer {
  background: #008cff; /* Ù„ÙˆÙ† Ø®Ù„ÙÙŠØ© Ø²Ø§Ù‡ÙŠ */
  color: #fff; /* Ø§Ù„Ù†Øµ Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø¨ÙŠØ¶ */
  text-align: center;
  padding: 20px;
  border-radius: 12px;
  margin-top: 30px; /* Ù…Ø³Ø§ÙØ© Ù…Ù† Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ø³Ø§Ø¨Ù‚ */
  font-size: 16px;
  box-shadow: 0 4px 6px rgba(0, 0, 0, 0.2); /* ØªØ£Ø«ÙŠØ± Ø§Ù„Ø¸Ù„ */
}

footer a {
  color: #fff; /* Ø±Ø§Ø¨Ø· Ø¨Ø§Ù„Ù„ÙˆÙ† Ø§Ù„Ø£Ø¨ÙŠØ¶ */
  text-decoration: none; /* Ø¥Ø²Ø§Ù„Ø© Ø§Ù„ØªØ³Ø·ÙŠØ± */
  font-weight: bold; /* Ø¬Ø¹Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· Ø³Ù…ÙŠÙƒ */
}

footer a:hover {
  color: #ff8c00; /* ØªØºÙŠÙŠØ± Ø§Ù„Ù„ÙˆÙ† Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
  text-decoration: underline; /* Ø¥Ø¶Ø§ÙØ© Ø§Ù„ØªØ³Ø·ÙŠØ± Ø¹Ù†Ø¯ Ø§Ù„ØªÙ…Ø±ÙŠØ± */
}

footer p {
  margin: 0;
  font-size: 14px;
  color: #d0e4ff; /* Ù„ÙˆÙ† Ø±Ù…Ø§Ø¯ÙŠ ÙØ§ØªØ­ */
  line-height: 1.5; /* Ø§Ù„Ù…Ø³Ø§ÙØ© Ø¨ÙŠÙ† Ø§Ù„Ø£Ø³Ø·Ø± */
}

/* ØªØ­Ø³ÙŠÙ† Ø¹Ù„Ù‰ Ø§Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
@media (max-width: 600px) {
  footer {
    font-size: 14px;
    padding: 15px;
  }

  footer a {
    font-size: 14px;
  }
}
      /* ØªØ­Ø³ÙŠÙ† Ø¥Ø¶Ø§ÙÙŠ Ù„Ù„Ø´Ø§Ø´Ø§Øª Ø§Ù„ØµØºÙŠØ±Ø© */
      @media (max-width: 600px) {
        h2 {
          font-size: 20px;
        }
        h3 {
          font-size: 17px;
        }
        th,
        td {
          font-size: 13px;
        }
      }
    </style>
  </head>

  <body>
    <div class="box" id="reportContent">
      <h2>ğŸ“„ ØªÙ‚Ø±ÙŠØ± Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª</h2>
      <p id="currentTime" style="text-align: center; color: #555"></p>

      <input id="search" placeholder="ğŸ” Ø¨Ø­Ø« Ø¨Ø§Ø³Ù… Ø§Ù„Ø¹Ø§Ù…Ù„" />

      <h3>âš ï¸ Ù„Ø¯ÙŠÙ‡Ù… Ù…ØªØ¨Ù‚ÙŠ</h3>
      <div class="table-wrap">
        <table id="remain"></table>
      </div>

      <h3>âœ… ØªÙ… Ø§Ù„Ø¯ÙØ¹ ÙƒØ§Ù…Ù„</h3>
      <div class="table-wrap">
        <table id="full"></table>
      </div>

      <h3>ğŸ’° Ø£Ø®Ø°ÙˆØ§ Ø£ÙƒØ«Ø± Ù…Ù† Ø§Ù„Ù…Ø±ØªØ¨</h3>
      <div class="table-wrap">
        <table id="over"></table>
      </div>

      <div class="actions">
        <button id="backBtn" onclick="location.href='index.html'"> Ø¹ÙˆØ¯Ø©</button>
        <button id="printPdf">ğŸ§¾ ØªÙ†Ø²ÙŠÙ„ PDF</button>
        <button onclick="window.print()">ğŸ–¨ï¸ Ø·Ø¨Ø§Ø¹Ø©</button>
      </div>
    </div>

<footer>
  <p>&copy; 2025 <a href="https://www.example.com">Eyad Abdallah</a> | All rights reserved</p>
</footer>


    <!-- Firebase -->
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

    <!-- jsPDF & html2canvas -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

    <script>
      var firebaseConfig = {
        apiKey: "AIzaSyAu9HDit-G8JllC-wcTmvXx7vchWmNs9ms",
        authDomain: "ali-eisesy.firebaseapp.com",
        databaseURL: "https://ali-eisesy-default-rtdb.firebaseio.com",
        projectId: "ali-eisesy",
        storageBucket: "ali-eisesy.appspot.com",
        messagingSenderId: "31241139042",
        appId: "1:31241139042:web:66b06edcded73616c8f23b",
      };
      firebase.initializeApp(firebaseConfig);
      var db = firebase.database();

      let data = [],
        keys = [];

      db.ref("workers").on("value", (snap) => {
        data = [];
        keys = [];
        snap.forEach((c) => {
          data.push(c.val());
          keys.push(c.key);
        });
        render();
      });

      function updateTime() {
        currentTime.innerText = new Date().toLocaleString("ar-EG");
      }
      updateTime();
      setInterval(updateTime, 1000);

      function render() {
        let s = search.value.toLowerCase();

        remain.innerHTML =
          "<tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø±ØªØ¨</th><th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><th>Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>";
        full.innerHTML =
          "<tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø±ØªØ¨</th><th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>";
        over.innerHTML =
          "<tr><th>Ø§Ù„Ø§Ø³Ù…</th><th>Ø§Ù„Ù…Ø±ØªØ¨</th><th>Ø§Ù„Ù…Ø³ØªÙ„Ù…</th><th>Ø§Ù„Ø²ÙŠØ§Ø¯Ø©</th><th>Ø§Ù„ØªØ§Ø±ÙŠØ®</th><th>Ø¥Ø¬Ø±Ø§Ø¡</th></tr>";

        data.forEach((d, i) => {
          if (s && !d.name.toLowerCase().includes(s)) return;

          if (d.received > d.salary) {
            over.innerHTML += `
            <tr>
              <td>${d.name}</td><td>${d.salary}</td><td>${d.received}</td>
              <td>${d.received - d.salary}</td><td>${d.date}</td>
              <td><button class="del" onclick="del('${keys[i]}')">Ù…Ø³Ø­</button></td>
            </tr>`;
          } else if (d.remaining > 0) {
            remain.innerHTML += `
            <tr>
              <td>${d.name}</td><td>${d.salary}</td><td>${d.received}</td>
              <td>${d.remaining}</td><td>${d.date}</td>
              <td>
                <button class="pay" onclick="payMore('${keys[i]}')">Ø¯ÙØ¹</button>
                <button class="del" onclick="del('${keys[i]}')">Ù…Ø³Ø­</button>
              </td>
            </tr>`;
          } else {
            full.innerHTML += `
            <tr>
              <td>${d.name}</td><td>${d.salary}</td><td>${d.received}</td>
              <td>${d.date}</td>
              <td><button class="del" onclick="del('${keys[i]}')">Ù…Ø³Ø­</button></td>
            </tr>`;
          }
        });
      }

      function del(key) {
        if (confirm("Ù…Ø³Ø­ Ù‡Ø°Ø§ Ø§Ù„Ø³Ø¬Ù„ØŸ")) db.ref("workers/" + key).remove();
      }

      function payMore(key) {
        let add = Number(prompt("Ø§Ù„Ù…Ø¨Ù„Øº Ø§Ù„Ø¥Ø¶Ø§ÙÙŠ"));
        if (add <= 0) return;
        db.ref("workers/" + key).once("value", (snap) => {
          let d = snap.val();
          d.received += add;
          d.remaining = Math.max(0, d.salary - d.received);
          d.date = new Date().toLocaleString("ar-EG");
          db.ref("workers/" + key).set(d);
        });
      }

      search.addEventListener("input", render);

      document.getElementById("printPdf").addEventListener("click", () => {
        const { jsPDF } = window.jspdf;
        const pdf = new jsPDF("p", "mm", "a4");
        const w = pdf.internal.pageSize.getWidth();

        pdf.setFontSize(18);
        pdf.text("Ù†Ø¸Ø§Ù… Ø¯ÙØ¹ Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª", w / 2, 15, { align: "center" });
        pdf.setFontSize(12);
        pdf.text("Ø§Ø³Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹: Ø´Ø±ÙƒØ© Ø§Ù„Ù…Ù‚Ø§ÙˆÙ„Ø§Øª Ø§Ù„Ø­Ø¯ÙŠØ«Ø©", w / 2, 23, {
          align: "center",
        });
        pdf.text(
          "ØªØ§Ø±ÙŠØ® Ø§Ù„ØªÙ‚Ø±ÙŠØ±: " + new Date().toLocaleString("ar-EG"),
          w / 2,
          30,
          { align: "center" }
        );
        pdf.line(10, 35, w - 10, 35);

        html2canvas(reportContent, { scale: 2 }).then((canvas) => {
          const imgW = w - 20;
          const imgH = (canvas.height * imgW) / canvas.width;
          pdf.addImage(canvas.toDataURL(), "PNG", 10, 40, imgW, imgH);
          pdf.save("ØªÙ‚Ø±ÙŠØ±_Ø§Ù„Ù…Ø±ØªØ¨Ø§Øª.pdf");
        });
      });
    </script>
  </body>
</html>
